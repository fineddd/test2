syntax = "proto2";

package SGMsg;

import "SGMsgBase.proto";
import "SGMsgMapData.proto";
import "SGMsgCity.proto";

enum DungeonType
{
	RACE			 = 1;	//赛车玩法
	TOWER_DEFENCE	 = 2;	//塔防玩法
	RPG_DUNGEON		 = 3;	//RPG玩法
	BATTLE_ROYALE	 = 4;	//逃杀玩法
	CPM_DUNGEON		 = 5;	//cpm副本
}

enum EDGNState
{
	DGNS_None						 = 1;	
	DGNS_InMatch					 = 2;	//匹配中
	DGNS_InDungeon					 = 3;	//副本中
	DGNS_SETTLE_DUNGEON				 = 4;	//在副本结算界面	服务器使用
	DGNS_PREPARE					 = 5;	//准备进入副本	服务器使用	
}

// MSG_C2S_LOADING_DUNGEON   											 = 2821;	//通知loading结束进入副本
message C2SLoadingDungeon
{
	optional int64 dungeon_id = 1; // 副本ID
}

//	MSG_S2C_NTF_ENTER_DUNGEON											 = 2822;	//通知进入副本
message NtfEnterDungeon
{
	required int32 dungeon_type							 = 1;	//玩法类型，DungeonType
	required int64 dungeon_id							 = 2;	//对应玩法的id，不同的玩法 id 可能在不同表中
	
	optional int64 random_seed							 = 3;
	repeated int64 heros								 = 4;	//进入副本英雄
	optional int32 source_type							 = 5;	//服务器使用 进入副本的玩法来源类型
	repeated DungeonHeroInfo hero_info_list				 = 6;	//英雄列表
	optional int64 main_level							 = 7;	//MainLevelIndex的ID,只有地格和战役关卡的rpg副本这个字段会赋值
}

enum EDGNSettleType
{
	DUNGEON_WIN				 = 1;
	DUNGEON_FAIL			 = 2;
    DUNGEON_LEAVE            = 3;
	DUNGEON_SKIP			 = 7; // cpm 跳过
}

message SettleHeroData
{
	optional int64 hero_id					 = 1;
	optional int64 before_level_id			 = 2;
	optional int64 before_exp				 = 3;
	optional int64 after_level_id			 = 4;
	optional int64 after_exp				 = 5;
	optional int64 before_origin_level_id	 = 6; // 养成前等级
	optional int64 after_origin_level_id	 = 7; // 养成后等级
	optional int64 is_resonate		 		 = 8; // 是否共鸣
}

//	MSG_S2C_NTF_DUNGEON_END												 = 2823;	//副本结束
message NtfDungeonEnd
{
	required int32 dungeon_type							 = 1;	//玩法类型，DungeonType
	required int64 dungeon_id							 = 2;	//对应玩法的id，不同的玩法 id 可能在不同表中
	optional int32 result								 = 3;	//胜利、失败等 EDGNSettleType
	//其他结算需要的参数
	repeated ItemInfo item_list 						 = 4; // 关卡掉落物品
	optional int32 dungeon_source						 = 5;	//EDungeonSourceType 副本玩法进入方式
	optional int32 campaign_count						 = 6;	//当前章节副本 进入次数
	repeated ItemInfo ex_item_list 						 = 7; // 关卡额外获得物品
	repeated SettleHeroData hero_list					 = 8;
	optional BTRSettleParam btr_param					 = 9;
}

message BTRSettleParam
{
	optional int32 rank					 = 1;	//排名
	optional int64 max_power			 = 2;	//最高战力
	optional int32 survival_time		 = 3;	//存活时间	
	optional int32 kill_count			 = 4;	//杀敌次数
	optional int32 survival_score		 = 5;	//存活积分
	optional int32 kill_score			 = 6;	//击杀积分
	optional int32 common_score			 = 7;	//公共积分分成
	optional int32 get_item_count		 = 8;	//拾取物品次数
	optional int32 get_relic_count		 = 9;	//获取宝物次数
	optional int32 incr_soldier_count	 = 10;	//兵力增长次数
	
	optional int64 activity_score		 = 11;	//活动期间累计积分，服务器使用
	optional int64 settle_score			 = 12;	//副本最终结算积分
	
	optional int64 begin_power					 = 13;	//初始战力
	optional int32 revive_count					 = 14;	//复活次数
	optional int32 get_suppliy_count			 = 15;	//获取空头次数
	optional int32 dungeon_state				 = 16;	//结算时副本状态 0 副本已结束不能继续观战，1 副本可以继续观战
}

// MSG_C2S_REPORT_DUNGEON   											 = 2820;	//上报副本埋点
message ReqReportDungeon
{
	optional int32 type = 1; // 5 上报房间和门，6 上报拾取物品
	optional int32 room_id = 2; // 房间
	optional int32 door_id = 3; // 门
	optional string doc_info = 4; // 拾取物品信息等
}

//	MSG_C2S_REQ_LEAVE_DUNGEON											 = 2824;	//请求离开副本玩法
message ReqLeaveDungeon
{
	optional int64 dungeon_guid							 = 1;	//服务器使用，副本guid
	optional int32 dungeon_type							 = 2;
    optional int32 battle_auto                           = 3; ////自动战斗开启状态，0关闭，1开启
    optional int32 speed_up                              = 4; //加速战斗开启状态，0关闭，1开启
    optional int32 skill_break_count                     = 5; //技能打断次数
    optional int32 use_skill_count                       = 6; //玩家手动使用技能次数(自动的不统计)
	optional string soldier_info						 = 7; //结束上报士兵信息
	optional int32 leave_type							 = 8; //离开类型 0 正常离开 1 跳过
}

//	MSG_GS2SCS_REQ_CREATE_DUNGEON_DATA									 = 2825;	//game to scenceclone 请求初始化副本数据
message ReqCreateDungeonData
{
	required int32 dungeon_type							 = 1;	//玩法类型，DungeonType
	required int64 dungeon_id							 = 2;	//对应玩法的id，不同的玩法 id 可能在不同表中
	required GS2SSUPlayerOnLineView player_data			 = 3;
}
//	MSG_SCS2GS_RSP_CREATE_DUNGEON_DATA									 = 2826;	//scenceclone to game 初始化副本数据响应
message RspCreateDungeonData
{
	required int32 result								 = 1;
	optional int64 dungeon_guid							 = 2;
}

//	MSG_SCS2GS_NTF_DUNGEON_END											 = 2830;	//scenceclone to game 副本结束
message ServerNTFDungeonEnd
{
	required int32 result								 = 1;	//EDGNSettleType
	optional int64 dungeon_guid							 = 2;
	optional RaceDGNSettleInfo race_end					 = 3;
	optional BTRSettleParam btr_param					 = 4;
    optional int32 battle_auto                           = 5; ////自动战斗开启状态，0关闭，1开启
    optional int32 speed_up                              = 6; //加速战斗开启状态，0关闭，1开启
    optional int32 skill_break_count                     = 7; //技能打断次数
    optional int32 use_skill_count                       = 8; //玩家手动使用技能次数(自动的不统计)
	optional string soldier_info						 = 9; //结束上报士兵信息
}
message RaceDGNSettleInfo
{
	repeated int64 monster_rewards						 = 1;
}

//	MSG_C2S_REQ_SET_DUNGEON_INIT_DATA									 = 2827;	//设置副本初始化数据（英雄阵容等）
message ReqSetDungeonInitData
{
	optional EventRpgDungeonParam rpg_param					 = 1;
	optional int32 dungeon_type = 2; 
}
//	MSG_S2C_RSP_SET_DUNGEON_INIT_DATA									 = 2828;	//设置副本初始化数据（英雄阵容等）
message RspSetDungeonInitData
{
	optional int32 result									 = 1;	// MsgTip  0 成功
	repeated DungeonHeroInfo hero_info_list					 = 2;	//英雄列表
	optional int32 dungeon_type = 3; 
}

// ------------------- 战役副本--------------------------------
//enum EDungeonSourceType
//{
//	CHAPTER_DUNGEON = 1;//战役副本
//	RANDOM_EVENT	 = 2;// 随机事件副本
//	EXPLORE_DUNGEON = 3;// 探索副本
//}

//MSG_C2S_REQ_CHAPTER_CHALLANGE										 = 2850;// 请求挑战赛车关卡
message ReqChapterChallenge
{
}

//MSG_C2S_REQ_ENTER_RANDOM_EVENT										 = 2853;	//请求随机事件
message ReqEnterRandomEvent
{
	required int64 config 	= 1;
}

// MSG_C2S_REQ_HANGUP_REWARD											 = 2851;请求领取挂机奖励   
message ReqHangUpReward
{
	enum EOptype
	{
		OPT_OPEN = 1;// 打开
		OPT_AWARD = 2;// 领奖
	}
	required EOptype nType = 1;
}

// MSG_S2C_ACK_HANGUPREWARD												 = 2852;返回挂机奖励
message AckHangUpReward
{
	repeated ItemInfo items = 1;	// 挂机奖励
	optional int32 nType = 2;		// 操作类型
}

//	MSG_C2S_REQ_DUNGEON_RESTART												 = 2855;	//请求副本重新开始
message ReqDungeonRestart
{
	
}
//	MSG_S2C_RSP_DUNGEON_RESTART												 = 2856;	//返回副本重新开始
message RspDungeonRestart
{
	optional int64 random_seed						 = 1;	//重新开始的随机种子
}

//	MSG_C2S_REQ_DUNGEON_SETTLE												 = 2857;	//副本结算
message ReqDungeonSettle
{
	optional int32 result								 = 1;	//副本结果 EDGNSettleType
	repeated ItemInfo item_list 						 = 2; // 关卡拾取物品
	repeated int32 achievement							 = 3;	//rpg副本达成条件 1\2\3
    optional int32 battle_auto                           = 4; ////自动战斗开启状态，0关闭，1开启
    optional int32 speed_up                              = 5; //加速战斗开启状态，0关闭，1开启
    optional int32 skill_break_count                     = 6; //技能打断次数
    optional int32 use_skill_count                       = 7; //玩家手动使用技能次数(自动的不统计)
	optional string soldier_info						 = 8; //结束上报士兵信息
}


//	MSG_C2S_START_DUNGEON_LOGIC									 = 2859;	//客户端上报副本开始
message ReqStartDungeonLogic
{
	
}
//-------------------------rpg副本------------------------

// MSG_C2S_GOLD_DUNGEON_REWARD                                          = 2870;    // 请求付费活动奖励
message ReqGetRewardByGold
{
	repeated ItemInfo items = 1;	// 挂机奖励
}

message BTRSGParam
{
	optional MOSoldierGroup soldier				 = 1;
	optional S2CNtfGeneralProperty city_property		 = 2;
}

message MatchPlayer
{
	optional int64 game_server				 = 1;	//玩家所在gameserver id
	optional bytes param					 = 2;	//玩法参数 可能是英雄之类的 大逃杀 BTRSGParam
	optional GUID player					 = 3;	//
	optional string player_name				 = 4;
	optional string alliance_tag			 = 5;
	optional int64 match_pwoer 				 = 6;	// 匹配战力
	optional string avatar_url               = 7;   //玩家头像
}
//	MSG_S2S_REQ_DUNGEON_MATCH											 = 2831;	//服务器内请求匹配
message ReqDungeonMatch
{
	optional DungeonType type				 = 1;	//副本玩法类型
	optional int64 id						 = 2;	//副本玩法id
	optional int32 source_type				 = 3;	//来源入口功能类型
	optional int64 source_id				 = 4;	//来源入口功能id	//暂时可能不需要
	optional MatchPlayer player_data		 = 5;	//玩家数据
}

//	MSG_S2S_NTF_DUNGEON_STATE											 = 2832;	//通知副本状态
//	MSG_S2C_NTF_DUNGEON_STATE											 = 2834;	//通知客户端副本状态
message NTFDungeonState
{
	optional int32 type						 = 1;	//副本玩法类型
	optional int64 id						 = 2;	//副本玩法id
	optional int32 source_type				 = 3;	//来源入口功能类型
	optional int32 state					 = 4;	//EDGNState
	optional int64 dungeon_room				 = 5;
	optional int32 dungeon_server_type		 = 6;
	optional int32 dungeon_server_id		 = 7;
	optional int64 match_start_time			 = 8;	//
}
	
//	MSG_S2S_REQ_MATCH_DUNGEON_START											 = 2833;	//
message ReqMatchDungeonStart
{
	optional DungeonType type							 = 1;	//副本玩法类型
	optional int64 id									 = 2;	//副本玩法id
	optional int32 source_type							 = 3;	//来源入口功能类型
	repeated MatchPlayer player_datas					 = 4;
	optional int64 max_player_count						 = 5;	//最大人数 --填充机器人用
	optional int64 match_id								 = 6;	//匹配表ID
}

//	MSG_C2S_REQ_CANCEL_DUNGEON_MATCH									 = 2835;	//取消副本匹配
message ReqCancelDungeonMatch
{

}

//	MSG_RPC_CHECK_BTRSOLDIER_COUNT					= 50141;	//检查大逃杀队伍士兵数量
//	MSG_C2S_REQ_BATTLE_ROYALE_ACTIVITY_MATCH							 = 2838;	//大逃杀活动匹配
message ReqBattleRoyaleActivityMatch
{
	optional int64 activity_id						 = 1;
	optional MOSoldierGroup soldier_group			 = 2;	//部队信息
	optional int32 rpc_result						 = 3;	//服务器使用
	optional GUID city_id							 = 4;	//服务器使用
}



//MSG_C2S_Dungeon_UseItem_Skill  = 2880;// 副本使用技能
message C2SDungeonUseItemSkill
{
	optional int64 config_id	= 1;	// 物品id
	optional GUID targert_id	= 2;	// 选取的目标ID
}

message BREffectData
{
	optional GUID target			 = 1;	//目标guid
	optional int64 data			 	 = 4;	//治疗或者伤害数值
}


//MSG_NTF_DUNGEON_USEITEM_SKILL  = 2881;// 副本使用技能： 广播包
message NTFDungeonUseItemSkill
{
	optional int64 config_id				= 1;	// 物品id
	optional GUID target			 = 2;	//目标guid
	optional GUID attack_id					= 3;	// 攻方GUID

	repeated int64 effect_id				= 4;	//当前使用技能ID
	repeated BREffectData damage_data		= 5;	//伤害列表
	repeated BREffectData cure_data		= 6;	//治疗列表
	optional bytes soldier_data				= 7;	// 部队数据NTFNewSoldierDataUpdate

	optional Point2D new_pos = 8;	// 新坐标
}

//MSG_C2S_DUNGEON_GET_ITEMS      = 2882;// 获取道具
message C2SDungeonGetItems
{
	optional GUID item_guid	= 1;	// 物品id
}



// 部队胜利
// MSG_NTF_BRSG_KILL              = 2891;// 部队副本击杀
message NTFBrSGKill
{
	optional int64 power_up					 = 1;	//实力提升值
	optional GUID power_source_id			 = 2;	//获取实力值的来源
	optional GUID power_target_id			 = 3;	//获取实力值的目标
}

// 部队战败
// MSG_NTF_BRSG_DEFEAT            = 2892;// 部队副本死亡
message NTFBrSGDefeat
{
	optional int64 revive_end_time			 = 1;	//复活结束时间(毫秒)
	optional GUID revive_source_id			 = 2;	//复活ID
}

//MSG_C2S_BATTLEROYALE_REVIVE     = 2883； //玩家复活请求
message ReqBattleRoyaleRevive  
{
	enum ReviveType
	{
		LOCAL = 1;  //原地复活
		SAFETY = 2;  //安全区域
	}

	optional int32 revive_num = 1;  //复活次数
	optional int32 revive_type = 2;  //复活类型
}

//MSG_S2S_RPC_BATTLEROYALE_REVIVE                 = 50300;   //Rpc请求复活
message RpcS2SBattleRoyaleRevive
{
	optional GUID player_id = 1;  //玩家ID
	optional int32 revive_num = 2;  //复活次数
	optional int32 revive_type = 3;  //复活类型
	optional bool success = 4;  //是否成功
}

//MSG_C2S_BATTLEROYALE_QUIT       = 2884;  //玩家退出请求
message ReqBattleRoyaleQuit
{

}

//MSG_NTF_BR_BASIC_INFO          = 2894; //地图基础信息通知
message NtfBrBasicInfo   //大逃杀基础信息通知
{
	enum NotifyType
	{
		notify_player_count = 1; //当前玩家人数
		notify_item_count = 2;	//物品数量
		notify_common_score = 3;  //公共积分
	}

	message NotifyData
	{
		optional int32 notify_type = 1;
		optional int64 value = 2;
		optional GUID object_id = 3;
	}

	repeated NotifyData data_list = 1;
}

//MSG_NTF_BR_Kill_INFO           = 2895;  //地图击杀信息
message NtfBrKillInfo
{
	repeated string str_info = 1;
	optional int32 kill_count = 2;  //击杀数量
}

//MSG_NTF_BT_TAKESOLDIERITEM     = 2896;  //玩家拾取士兵道具通知
message NtfTakeSoldierItem
{
	optional int64 config_id = 1;	
}

//MSG_NTF_BT_GET_KILL_SCORE      = 2897;  //获得击杀积分
message NftGetKillScore
{
	optional GUID object_id = 1;  //部队ID
	optional int64 kill_score = 2;  //击杀积分
}

message BTROBRankData
{
	optional int32 rank						 = 1;	// 排名
	optional string alliance_tag			 = 2;	// 联盟简称
	optional string player_name				 = 3;	// 玩家名字
	optional int64 power					 = 4;	// 最高战力
	optional int32 points					 = 5;	// 积分
	optional GUID player_id					 = 6;
}
//	MSG_S2C_NTF_BTR_OBSERVER_END										 = 2842;	//通知大逃杀副本观战结束
message NtfBTRObserverEnd
{
	repeated BTROBRankData data_list			 = 1;
}

//	MSG_C2S_REQ_GET_DUNGEON_LIST_PROGRESS_REWARD		 = 2128;// 获取关卡进度阶段性奖励
message ReqGetDungeonListProgressReward
{
	repeated int32 id_list					 = 1;
}

//	MSG_C2S_REQ_CPM_ACCESS_ENTER										 = 2843;	//进入特训基地cpm副本
message ReqCpmAccessEnter
{
	optional int32 type							 = 1;	//小游戏类型
}
////	MSG_C2S_REQ_CPM_ACCESS_REWARD										 = 2844;	//领取特训基地cpm副本奖励
//message ReqCpmAccessReward
//{
//	optional int32 type							 = 1;	//小游戏类型
//}
